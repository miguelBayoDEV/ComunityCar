{% extends 'base.html.twig' %}

{% block title %}Perfil{% endblock %}

{% block body %}
    <h1 id="datosPersonales">Datos personales:</h1>

    <div id="avatar">
        {{ form_start(avatarForm) }}
            {% if user.avatar != null %}
                <img src="/avatar/{{ user.avatar }}" width="250px" height="250px" />
            {% else %}
                <p>No ha introducido su avatar</p>
            {% endif %}
            {{ form_row(avatarForm.avatar) }}
            <button type="submit" class="btn">Modificar</button>
        {{ form_end(avatarForm) }}
    </div>

    <div id="nombreDiv">
        {% if user.nombre != null or user.nombre != "" %}
            <input type="text" id="nombre" name="nombre" value="{{ user.nombre }}" />
        {% else %}
            <input type="text" id="nombre" name="nombre" value="" placeholder="Campo nombre sin rellenar" />
        {% endif %}
        <button onClick="modificar('nombre')">Modificar</button>
    </div>

    <div id="primerApellidoDiv">
        {% if user.primerApellido != null or user.primerApellido != "" %}
            <input type="text" id="primerApellido" name="primerApellido" value="{{ user.primerApellido }}" />
        {% else %}
            <input type="text" id="primerApellido" name="primerApellido" value="" placeholder="Campo primer apellido sin rellenar" />
        {% endif %}
        <button onClick="modificar('primerApellido')">Modificar</button>
    </div>

    <div id="segundoApellidoDiv">
        {% if user.segundoApellido != null or user.segundoApellido != "" %}
            <input type="text" id="segundoApellido" name="segundoApellido" value="{{ user.segundoApellido }}" />
        {% else %}
            <input type="text" id="segundoApellido" name="segundoApellido" value="" placeholder="Campo segundo apellido sin rellenar" />
        {% endif %}
        <button onClick="modificar('segundoApellido')">Modificar</button>
    </div>

    <div id="nickDiv">
        {% if user.nick != null or user.nick != "" %}
            <input type="text" id="nick" name="nick" value="{{ user.nick }}" />
        {% else %}
            <input type="text" id="nick" name="nick" value="" placeholder="Campo nick sin rellenar" />
        {% endif %}
        <button onClick="modificar('nick')">Modificar</button>
    </div>

    <div id="localidadDiv">
        {% if user.localidad != null or user.localidad != "" %}
            <input type="text" id="localidad" name="localidad" value="{{ user.localidad }}" />
        {% else %}
            <input type="text" id="localidad" name="localidad" value="" placeholder="Campo localidad sin rellenar" />
        {% endif %}
        <button onClick="modificar('localidad')">Modificar</button>
    </div>

    <div id="provinciaDiv">
        {% if user.provincia != null or user.provincia != "" %}
            <input type="text" id="provincia" name="provincia" value="{{ user.provincia }}" />
        {% else %}
            <input type="text" id="provincia" name="provincia" value="" placeholder="Campo provincia sin rellenar" />
        {% endif %}
        <button onClick="modificar('provincia')">Modificar</button>
    </div>

    <div id="telefonoMovilDiv">
        {% if user.telefonoMovil != null or user.telefonoMovil != "" %}
            <input type="number" id="telefonoMovil" name="telefonoMovil" value="{{ user.telefonoMovil }}" />
        {% else %}
            <input type="number" id="telefonoMovil" name="telefonoMovil" value="" placeholder="Campo teléfono móvil sin rellenar" />
        {% endif %}
        <button onClick="modificar('telefonoMovil')">Modificar</button>
    </div>

    <h1>Lista de vehículos mios:</h1>
    {% for vehiculo in user.vehiculos %}
        {% if vehiculo.eliminado == true %}
            <div class="vehicles">
                Marca: {{ vehiculo.marca }}
                <br/>
                Modelo: {{ vehiculo.modelo }}
                <br/>
                Descripción: {{ vehiculo.descripcion }}
                <br/>
                Precio: {{ vehiculo.precio }} euros.
                <br/>
                {% if vehiculo.venta == false %}
                    <button onClick="addBuscador({{ vehiculo.id }});">Añadir a venta</button>
                {% endif %}
            </div>
        {% endif %}
    {% endfor %}

    <h1>Lista de vehículos en venta:</h1>
    {% for vehiculo in user.vehiculos %}
        {% if vehiculo.venta == true and vehiculo.eliminado == false %}
            <div class="vehicles">
                Marca: {{ vehiculo.marca }}
                <br/>
                Modelo: {{ vehiculo.modelo }}
                <br/>
                Descripción: {{ vehiculo.descripcion }}
                <br/>
                Precio: {{ vehiculo.precio }} euros.
                <br/>
                <button onClick="eliminarBuscador({{ vehiculo.id }});">Eliminar de venta</button>
            </div>
        {% endif %}
    {% endfor %}

    {# Añadir nuevo vehículo para vender #}
    <button><a href="/vehiculo/new">Introducir vehículo a vender</a></button>

    <script>
        function modificar(id) {

            var datos = {
                'dato':$("#"+id).val(),
                'condicion':id
            };

            function fail(data) {
                alert("Error de AJAX: " + data);
            }

            $.ajax({
                type: "GET",
                url: "/modificar",
                data: datos,
                success: function(data) {
                    if(data == "error") {
                        alert("Error");
                    }else if(data == "nombre") {
                        $("#nombreDiv").val('{{user.nombre}}');
                    }else if(data == "primerApellido") {
                        $("#primerApellidoDiv").val('{{user.primerApellido}}');
                    }else if(data == "segundoApellido") {
                        $("#segundoApellidoDiv").val('{{user.segundoApellido}}');
                    }else if(data == "nick") {
                        $("#nickDiv").val('{{user.nick}}');
                    }else if(data == "localidad") {
                        $("#localidadDiv").val('{{user.localidad}}');
                    }else if(data == "provincia") {
                        $("#provinciaDiv").val('{{user.provincia}}');
                    }else if(data == "telefonoMovil") {
                        $("#telefonoMovilDiv").val('{{user.telefonoMovil}}');
                    }
                },
                error: fail
            });
        }

        function eliminarBuscador(id) {

            function fail(data) {
                alert("Error de AJAX: " + data);
            }

            $.ajax({
                type: "GET",
                url: "/eliminarVehiculoBuscador",
                data: {'id_vehiculo': id},
                success: function(data) {
                    if(data == "1") {
                        alert("Vehiculo eliminado correctamente del buscador y en venta.");
                        window.location.reload();
                    }
                },
                error: fail
            });
        }

        function addBuscador(id) {
            function fail(data) {
                alert("Error de AJAX: " + data);
            }

            $.ajax({
                type: "GET",
                url: "/addVehiculoBuscador",
                data: {'id_vehiculo': id},
                success: function(data) {
                    if(data == "1") {
                        alert("Vehiculo añadido correctamente del buscador y en venta.");
                        window.location.reload();
                    }
                },
                error: fail
            });
        }
    </script>
{% endblock %}